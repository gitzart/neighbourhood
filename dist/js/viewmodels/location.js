define(["jquery","knockout","googlemap","models/Location"],function(e,t,o,n){"use strict";function r(o){var r=this;r.destinations=t.observable({bounds:s.bounds().create(),info:t.observableArray()}),r.venues=t.observable({}),r.keyword=t.observable(),r.focusedLocation=t.observable(),r.destinations().info(e.map(o,function(e,o){var i=s.marker().create({id:o,position:e.position,title:e.name,animation:!0});e.isFavorite&&i.addIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png");var l=s.infoWindow().create({id:o,content:e.name,maxWidth:200}),y=new n(o,e.name,e.position,i,l,e.isFavorite);return y.nearbyVenues={bounds:a.bounds().create(),info:t.observableArray()},r.destinations().bounds.extend(i._marker.getPosition()),i.event.click(function(){i.bounce(),l.open(i._marker),r.focusedLocation()||(r.focusedLocation(y),a.trigger.resize(),a._map.setOptions({center:y.position,zoom:16}),y.marker._marker.setMap(a._map),r.findNearbyVenues(y))}).mouseOver(function(){r.focusedLocation()||l.open(i._marker)}).mouseOut(function(){r.focusedLocation()||l.close()}),l.event.close(function(){l.close()}),y})),r.destinations().bounds.fit(),r.saveDestinations=function(){var o=r.destinations().info(),n=t.observableArray(e.map(o,function(e,t){return{id:e.id,name:e.name,position:e.position,isFavorite:e.isFavorite}}));localStorage.setItem("destinations",t.toJSON(n))},r.saveDestinations(),r.filter=function(){var t=new RegExp(r.keyword().trim(),"i");e.each(r.destinations().info(),function(e,o){t.test(o.name)?(o.marker.show(),o.isFiltered(!0)):(o.marker.hide(),o.isFiltered(!1))})},r.openInfoWindow=function(e){e.marker.trigger.click()},r.closeInfoWindow=function(e){e.infoWindow.trigger.close()},r.toggleInfoWindow=function(e,t){"mouseover"===t.type?e.marker.trigger.mouseOver():"mouseout"===t.type&&e.marker.trigger.mouseOut(),"click"===t.type&&(e.infoWindow.isActive?(e.infoWindow.isActive=!1,r.closeInfoWindow(e)):(e.infoWindow.isActive=!0,r.openInfoWindow(e)))},r.toggleFavorite=function(e){e.isFavorite()?e.marker.removeIcon():e.marker.addIcon("https://maps.google.com/mapfiles/ms/icons/green-dot.png"),e.isFavorite(!e.isFavorite()),r.saveDestinations()},r.closeOverlay=function(){r.focusedLocation().marker._marker.setMap(s._map),r.focusedLocation(!1)},r.showInMap=function(t){var o=r.focusedLocation();e.each(o.nearbyVenues.info(),function(e,t){t.marker.hide(),r.closeInfoWindow(t)}),r.closeInfoWindow(o),t.marker.show(),a.bounds().create().extend(o.position).extend(t.position).fit()},r.findNearbyVenues=function(t){if(t.nearbyVenues.info().length)return void r.venues(t.nearbyVenues);r.venues({}),e(".venue-layout__content").empty(),e.get("https://api.foursquare.com/v2/venues/explore",{ll:t.position.lat+","+t.position.lng,venuePhotos:!0,client_id:l.clientID,client_secret:l.clientSecret,v:l.version}).done(function(o,i,s){var l=o.response.groups[0].items;if(0===l.length)return e(".venue-layout__content").empty(),void e("<div/>").addClass("error").append("No venues exist :(").appendTo(".venue-layout__content");t.nearbyVenues.info(e.map(l,function(e,o){var r=e.venue.name,i={lat:e.venue.location.lat,lng:e.venue.location.lng},s=a.marker().create({id:o,position:i,title:r}).addIcon("https://maps.google.com/mapfiles/ms/icons/yellow-dot.png").hide(),l=a.infoWindow().create({id:o,content:r,maxWidth:200}),y=new n(e.venue.id,r,i,s,l);return y.address={street:e.venue.location.formattedAddress[0],state:e.venue.location.formattedAddress[1],country:e.venue.location.formattedAddress[2]},y.category={name:e.venue.categories[0].name,icon:e.venue.categories[0].icon.prefix+"32"+e.venue.categories[0].icon.suffix},y.photo=e.venue.photos.groups[0].items[0].prefix+"width320"+e.venue.photos.groups[0].items[0].suffix,y.rating=e.venue.rating,y.tip=e.tips?e.tips[0].text:"No tips available :(",t.nearbyVenues.bounds.extend(s._marker.getPosition()),s.event.click(function(){l.open(s._marker)}),l.event.close(function(){l.close()}),y})),r.venues(t.nearbyVenues)}).fail(function(t,o,n){throw e(".venue-layout__content").empty(),e("<div/>").addClass("error mdl-typography--display-1").append(t.status+" "+n).appendTo(".venue-layout__content"),n})}}var i=[{featureType:"all",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels",stylers:[{saturation:"-100"},{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#d5c8a5"},{lightness:40},{visibility:"on"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{lightness:16},{color:"#000000"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:20},{color:"#000000"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#4d6059"}]},{featureType:"landscape",elementType:"geometry.stroke",stylers:[{color:"#4d6059"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#604d4d"}]},{featureType:"poi",elementType:"geometry",stylers:[{lightness:21}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#30423d"}]},{featureType:"poi",elementType:"geometry.stroke",stylers:[{color:"#30423d"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"on"},{color:"#7f8d89"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#7f8d89"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#44474e"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#7f8d89"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#3e5851"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#3e5851"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#3e5851"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#3e5851"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19},{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#2b3638"},{visibility:"on"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#2b3638"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#24282b"}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#24282b"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.icon",stylers:[{visibility:"off"}]}],s=(new o).create(document.querySelector("#map-canvas"),{center:{lat:40.7713024,lng:-73.9332393},zoom:8,styles:i}),a=(new o).create(document.querySelector("#overlay-map-canvas")),l={version:"20170410",clientID:"1C1I0SPV4ZZ4YDKCGFAIJ3BLE0MLOM3RDW1SYKBKUSXLOXIE",clientSecret:"G0NPXGT4NMLOH0W2CWBZEA5HPAYKXUNAHD55YT21AGPMPXYM"};return r});
//# sourceMappingURL=location.js.map
